<UserControl x:Class="Gita.Practice.App.Views.IndividualPracticeView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:Gita.Practice.App.ViewModels"
             xmlns:vw="clr-namespace:Gita.Practice.App.Views"
             mc:Ignorable="d"
             d:DesignHeight="300" d:DesignWidth="600">

    <UserControl.Resources>
        <vw:WaitModeToVisibilityConverter x:Key="WaitModeToVisibilityConverter" />

        <LinearGradientBrush x:Key="PlaybackNormalBrush" StartPoint="0,0" EndPoint="0,1">
            <GradientStop Color="#FF66A3FF" Offset="0"/>
            <GradientStop Color="#FF2D6BFF" Offset="1"/>
        </LinearGradientBrush>

        <LinearGradientBrush x:Key="PlaybackHoverBrush" StartPoint="0,0" EndPoint="0,1">
            <GradientStop Color="#FF6FB8FF" Offset="0"/>
            <GradientStop Color="#FF335EFF" Offset="1"/>
        </LinearGradientBrush>

        <Style x:Key="PlaybackButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PlaybackNormalBrush}" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="Padding" Value="10,6" />
            <Setter Property="Margin" Value="6,0" />
            <Setter Property="MinWidth" Value="72" />
            <Setter Property="MinHeight" Value="44" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="8"
                                Padding="{TemplateBinding Padding}"
                                SnapsToDevicePixels="True">

                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" RecognizesAccessKey="True" />
                        </Border>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource PlaybackHoverBrush}" />
                                <Setter TargetName="border" Property="Opacity" Value="0.98" />
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Opacity" Value="0.9" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="border" Property="Opacity" Value="0.45" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="PlayButtonStyle" TargetType="Button" BasedOn="{StaticResource PlaybackButtonStyle}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsPlaying}" Value="True">
                    <Setter Property="IsEnabled" Value="False" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="PauseStopButtonStyle" TargetType="Button" BasedOn="{StaticResource PlaybackButtonStyle}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsPlaying}" Value="False">
                    <Setter Property="IsEnabled" Value="False" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="LabelStyle">
            <Setter Property="Control.FontWeight" Value="Bold" />
            <Setter Property="Control.VerticalAlignment" Value="Center" />
            <Setter Property="Control.Margin" Value="0,0,8,0" />
        </Style>

        <Style x:Key="GroupBoxStyle">
            <Setter Property="Control.Margin" Value="0,12,8,0" />
            <Setter Property="Control.BorderBrush" Value="#800080" />
            <Setter Property="Control.BorderThickness" Value="1" />
        </Style>

        <Style x:Key="GroupBoxHeaderStyle">
            <Setter Property="Control.FontWeight" Value="Bold" />
            <Setter Property="Control.Foreground" Value="Blue" />
        </Style>
    </UserControl.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Hidden MediaElement bound to AudioSource in VM -->
        <MediaElement Name="mediaElement"
                      LoadedBehavior="Manual"
                      UnloadedBehavior="Stop"
                      Visibility="Collapsed"
                      Source="{Binding AudioSource}" />

        <!-- Your Turn settings -->
        <GroupBox Grid.Row="0" Style="{StaticResource GroupBoxStyle}">
            <GroupBox.Header>
                <TextBlock Text="Your turn" Style="{StaticResource GroupBoxHeaderStyle}" />
            </GroupBox.Header>

            <StackPanel Margin="8">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Wait Mode:" Style="{StaticResource LabelStyle}" />
                    <ComboBox Width="160" ItemsSource="{Binding Source={x:Static local:WaitModeValues.All}}" SelectedItem="{Binding WaitMode}" />

                    <TextBlock Text="Duration (sec):" Style="{StaticResource LabelStyle}" Margin="12,0,4,0" VerticalAlignment="Center"
                               Visibility="{Binding WaitMode, Converter={StaticResource WaitModeToVisibilityConverter}}" />

                    <TextBox Width="80" Text="{Binding YourDurationInSeconds, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             Visibility="{Binding WaitMode, Converter={StaticResource WaitModeToVisibilityConverter}}">
                        <TextBox.Style>
                            <Style TargetType="TextBox">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsPlaying}" Value="True">
                                        <Setter Property="IsEnabled" Value="False" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBox.Style>
                    </TextBox>

                    <!-- Added Repeat your sloka checkbox bound to ViewModel -->
                    <CheckBox Content="Repeat your sloka" Margin="12,0,0,0" VerticalAlignment="Center"
                              IsChecked="{Binding RepeatYourSloka, Mode=TwoWay}" />
                </StackPanel>
            </StackPanel>
        </GroupBox>

            <!-- Playback Speed group moved into its own GroupBox -->
            <GroupBox Grid.Row="1" Style="{StaticResource GroupBoxStyle}">
                <GroupBox.Header>
                    <TextBlock Text="Playback Speed" Style="{StaticResource GroupBoxHeaderStyle}" />
                </GroupBox.Header>

                <StackPanel Margin="8">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Background="Transparent">
                        <TextBlock Text="Playback Speed:" Style="{StaticResource LabelStyle}" Margin="0,0,4,0" VerticalAlignment="Center" />
                        <Slider x:Name="PlayingSpeedSlider"
                                Minimum="0.5"
                                Maximum="2.0"
                                TickFrequency="0.25"
                                IsSnapToTickEnabled="True"
                                Value="{Binding PlayingSpeed, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                Width="200"
                                VerticalAlignment="Center"
                                ToolTip="Playback speed (0.5x - 2.0x)" />

                        <TextBlock Text="{Binding PlayingSpeed, StringFormat={}{0:0.00}x}"
                                   VerticalAlignment="Center"
                                   Margin="8,0,0,0"
                                   Foreground="Black" />
                </StackPanel>
            </StackPanel>
        </GroupBox>

        <!-- Playback Buttons -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,12,0,0">
            <Button Style="{StaticResource PlayButtonStyle}" Command="{Binding PlayCommand}" ToolTip="Play">
                <TextBlock Text="Play" FontSize="12" />
            </Button>

            <Button Style="{StaticResource PauseStopButtonStyle}" Command="{Binding PauseCommand}" ToolTip="Pause">
                <TextBlock Text="Pause" FontSize="12" />
            </Button>

            <Button Style="{StaticResource PauseStopButtonStyle}" Command="{Binding StopCommand}" ToolTip="Stop">
                <TextBlock Text="Stop" FontSize="12" />
            </Button>
        </StackPanel>
    </Grid>
</UserControl>
